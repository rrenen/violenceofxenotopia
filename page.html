<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>V.O.X | Page Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Cloudinary Upload Widget -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0f0f0f;
      color: #f5f5f5;
      padding: 24px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }

    input, textarea, button {
      width: 100%;
      margin-bottom: 12px;
      padding: 10px;
      background: #1a1a1a;
      color: #fff;
      border: 1px solid #333;
      border-radius: 6px;
    }

    textarea {
      min-height: 200px;
      resize: vertical;
    }

    button {
      cursor: pointer;
      background: #fff;
      color: #000;
      font-weight: bold;
    }

    .preview {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #333;
    }

    .preview img {
      max-width: 100%;
      margin: 12px 0;
    }
  </style>
</head>
<body>

  <h1>V.O.X 記事エディター</h1>

  <input id="titleInput" placeholder="記事タイトル" />

  <textarea id="contentInput" placeholder="本文（改行OK）"></textarea>

  <button onclick="openUploader()">画像を追加</button>
  <button onclick="saveArticle()">記事を保存</button>

  <div class="preview" id="preview"></div>

  <script>
    const cloudName = "dmnwfksrm";

    function openUploader() {
      cloudinary.openUploadWidget(
        {
          cloudName: cloudName,
          uploadPreset: "unsigned",
          sources: ["local", "camera"],
          multiple: false,
          folder: "vox",
          resourceType: "image",
        },
        (error, result) => {
          if (!error && result && result.event === "success") {
            const imageUrl = result.info.secure_url;
            const textarea = document.getElementById("contentInput");
            textarea.value += `\n\n<img src="${imageUrl}" />\n\n`;
          }
        }
      );
    }

    function saveArticle() {
      const title = document.getElementById("titleInput").value;
      const content = document.getElementById("contentInput").value;

      const article = {
        id: Date.now(),
        title,
        content,
        createdAt: new Date().toISOString()
      };

      const articles = JSON.parse(localStorage.getItem("vox_articles") || "[]");
      articles.unshift(article);
      localStorage.setItem("vox_articles", JSON.stringify(articles));

      renderPreview(article);
      alert("保存しました（ブラウザ保存）");
    }

    function renderPreview(article) {
      const preview = document.getElementById("preview");
      preview.innerHTML = `
        <h2>${article.title}</h2>
        <div>${article.content}</div>
      `;
    }
  </script>

</body>
</html>
